!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},s.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);class i{constructor(t,e,s){[t.width,t.height]=[e,s],this.el=t,[this.width,this.height]=[e,s],this.ctx=t.getContext("2d"),this.number=2}}const n=new(window.AudioContext||window.webkitAudioContext),r=document.querySelector(".video-instance"),c=document.querySelector(".scene"),h=document.querySelector(".interface");let[o,a]=[770,650];window.innerWidth<770&&([o,a]=[window.innerWidth,window.innerHeight]);const d=new class{constructor(t,e){const s=new window.SpeechSynthesisUtterance("");s.lang=t,this.msg=s,this.speechSynthesis=e}setRate(t){this.msg.rate=t}setPitch(t){this.msg.pitch=t}setText(t){this.msg.text=t}speak(){const{speechSynthesis:t,msg:e}=this;t.speak(e)}}("en-US",window.speechSynthesis);d.setRate(1),d.setPitch(.4),d.setText("Movement");const l=new class extends i{constructor(t,e,s,i,n,r){super(s,i,n),this.constraints={audio:!0,video:{width:i,height:n}},this.video=t,this.audioCtx=e,this.detected=!1,this.detectingInProcess=!1,this.speaker=r}load(){const{audioCtx:t}=this,e=t.createAnalyser();e.minDecibels=-80,e.maxDecibels=-8,e.smoothingTimeConstant=.4,e.fftSize=2048,this.analyser=e,navigator.mediaDevices.getUserMedia(this.constraints).then(s=>{this.video.src=URL.createObjectURL(s),t.createMediaStreamSource(s).connect(e),this.animate()})}getDataArray(){return this.dataArray}getAnalyser(){return this.analyser}detectMove(){const{detectingInProcess:t,oldRgb:e,rgb:s,speaker:i}=this;t||(Math.abs(e.r-s.r)+Math.abs(e.g-s.g)+Math.abs(e.b-s.b)>7?(i.speak(),this.setDetected(!0),this.setDetectedInProcess(!0),setTimeout(()=>{this.setDetectedInProcess(!1),this.setOldRGB(s)},2500)):this.setDetected(!1))}setDetected(t){this.detected=t}getDetected(){return this.detected}setDetectedInProcess(t){this.detectingInProcess=t}setRGB(t){this.rgb=t}setOldRGB(t){this.oldRgb=t}getRGB(){return this.rgb}animate(){const t={r:0,g:0,b:0};this.ctx.drawImage(this.video,0,0,this.width,this.height);const e=this.ctx.getImageData(0,0,this.width,this.height),{data:s}=e,{length:i}=s;let n=0,r=0,c=0;for(;n<i;)c+=1,t.r+=s[n],t.g+=s[n+1],t.b+=s[n+2],r=.5-Math.random(),s[n]+=255*r,s[n+1]+=255*r,s[n+2]+=255*r,n+=60;this.ctx.putImageData(e,0,0),t.r=~~(t.r/c),t.g=~~(t.g/c),t.b=~~(t.b/c),this.setRGB(t),requestAnimationFrame(this.animate.bind(this))}}(r,n,c,o,a,d);l.setRGB({r:0,g:0,b:0}),l.setOldRGB({r:0,g:0,b:0}),l.load(),new class extends i{constructor(t,e,s){super(t,e,s),this.bufferLength=2048}connectScene(t){return new Promise(e=>{this.scene=t;const s=t.getAnalyser();s.fftSize=2048;const i=s.fftSize,n=new Uint8Array(i);[this.analyser,this.bufferLength,this.dataArray]=[s,i,n],e(this)})}valToHex(t){const e=t.toString(16);return 1===e.length?`0${e}`:e}rgbToHex(t,e,s){return`#${this.valToHex(t)}${this.valToHex(e)}${this.valToHex(s)}`}drawDetected(){this.ctx.fillStyle="#00ffff",this.ctx.fillText("MOVEMENT_DETECTED",10,125)}animate(){const t=this.scene.getRGB();this.analyser.getByteTimeDomainData(this.dataArray),this.ctx.clearRect(0,0,400,400),this.ctx.fillStyle="rgb(200, 200, 200)",this.ctx.lineWidth=2,this.ctx.strokeStyle="rgb(204, 255, 255)",this.ctx.beginPath();const e=320/this.bufferLength;let s=10;for(let t=0;t<this.bufferLength;t+=1){const i=180+this.dataArray[t]/128*120/2;0===t?this.ctx.moveTo(s,i):this.ctx.lineTo(s,i),s+=e}this.ctx.stroke(),this.ctx.font="20px OCR-A",this.ctx.fillStyle="white";const i=this.rgbToHex(t.r,t.g,t.b);this.ctx.fillText(`AVERAGE_COLOR: ${i}`,10,50),this.ctx.fillText(`CURR_TIME: ${(new Date).getTime()}`,10,75),this.ctx.fillText(`T_4_HUMAN: ${(new Date).toDateString()}`,10,100),this.ctx.fillStyle=i,this.ctx.fillRect(10,140,320,30),this.ctx.strokeStyle="#fff",this.ctx.strokeRect(10,140,320,30),this.scene.getDetected()&&this.drawDetected(),this.scene.detectMove(),requestAnimationFrame(this.animate.bind(this))}}(h,o,a).connectScene(l).then(t=>t.animate())}]);